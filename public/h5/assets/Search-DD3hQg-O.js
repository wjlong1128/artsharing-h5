import{r as i,d as L,o as T,c as o,a as n,b as a,f as b,k as D,v as F,l as J,F as $,g as z,m as p,t as g,j as I,i as K,H as O,u as U,_ as j}from"./index-Ca_WJbkP.js";import{L as A}from"./LazyImg-I-7dYKJx.js";function E(){const m=i(1),l=i(10),r=i(0),u=i([]),_=i(!1),c=i(!0);function h(){m.value=1,r.value=0,u.value=[],c.value=!0}function y(d){u.value=u.value.concat(d)}function k(d){r.value=d}function S(){c.value=!1}return{page:m,pageSize:l,total:r,data:u,loading:_,hasMore:c,reset:h,append:y,updateTotal:k,setNoMore:S}}const P={class:"container"},R={class:"search"},q={key:0,class:"history"},G={class:"tags"},Q=["onClick"],W={key:1,class:"list"},X={class:"tips"},Y=["onClick"],Z={class:"img"},ee={class:"info"},te={class:"t1"},se={class:"t2"},ae={key:2,class:"list"},oe=L({__name:"Search",setup(m){const l=i(""),{page:r,pageSize:u,total:_,data:c,hasMore:h,reset:y,append:k,updateTotal:S,setNoMore:d}=E(),v=i([]);function V(){const e=localStorage.getItem("recentSearches");v.value=e?JSON.parse(e):[]}function w(e){if(!e)return;const t=[e,...v.value.filter(M=>M!==e)].slice(0,5);v.value=t,localStorage.setItem("recentSearches",JSON.stringify(t))}async function f(e=!0){e&&y();const t=await O.post("search/search",{search:l.value,page:r.value,pageSize:u.value});t.code===1&&(k(t.data.list||[]),S(t.data.total||0),c.value.length>=_.value&&d(),w(l.value))}const C=U();function x(e){e.types==="work"&&C.push(`/work/${e.id}`),e.types==="artist"&&C.push(`/artist/${e.id}`),e.types==="institution"&&C.push(`/institution/${e.id}`)}function H(){h.value&&(r.value+=1,f(!1))}T(V);function B(e){return console.log(e),!e||!e.thumb_img&&!e.image?"":e.thumb_img?`https://artsharing.vhost.chengzhanheng.cn/${e.thumb_img}`:e.image}return(e,t)=>{const M=K("a-empty");return n(),o("div",P,[a("div",R,[D(a("input",{class:"field",placeholder:"请输入关键词","onUpdate:modelValue":t[0]||(t[0]=s=>l.value=s),onKeyup:J(f,["enter"])},null,544),[[F,l.value]]),a("button",{class:"btn",onClick:f},"搜索")]),v.value.length?(n(),o("div",q,[t[1]||(t[1]=a("div",{class:"title"},"搜索记录",-1)),a("div",G,[(n(!0),o($,null,z(v.value,s=>(n(),o("span",{key:s,onClick:N=>{l.value=s,f()}},g(s),9,Q))),128))])])):b("",!0),p(c)&&p(c).length?(n(),o("div",W,[a("div",X,"相关条目有 "+g(p(_))+" 项",1),(n(!0),o($,null,z(p(c),(s,N)=>(n(),o("div",{class:"item",key:N,onClick:ne=>x(s)},[a("div",Z,[I(A,{src:B(s)},null,8,["src"])]),a("div",ee,[a("div",te,g(s.name),1),a("div",se,g(s.ename),1)])],8,Y))),128)),p(h)?(n(),o("div",{key:0,class:"loadmore",onClick:H},"加载更多")):b("",!0)])):(n(),o("div",ae,[I(M,{description:"暂无数据"})]))])}}}),le=j(oe,[["__scopeId","data-v-3271783c"]]);export{le as default};
