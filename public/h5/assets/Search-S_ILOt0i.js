import{r as i,d as L,o as T,c as o,a as n,b as a,f as N,k as U,v as A,l as D,F as $,g as B,m as p,t as g,j as I,i as E,H as F,u as J,B as K,_ as O}from"./index-CIuTTTRl.js";import{L as R}from"./LazyImg-DOVfvCEv.js";function j(){const m=i(1),c=i(10),r=i(0),u=i([]),_=i(!1),l=i(!0);function f(){m.value=1,r.value=0,u.value=[],l.value=!0}function y(d){u.value=u.value.concat(d)}function k(d){r.value=d}function S(){l.value=!1}return{page:m,pageSize:c,total:r,data:u,loading:_,hasMore:l,reset:f,append:y,updateTotal:k,setNoMore:S}}const P={class:"container"},q={class:"search"},G={key:0,class:"history"},Q={class:"tags"},W=["onClick"],X={key:1,class:"list"},Y={class:"tips"},Z=["onClick"],ee={class:"img"},te={class:"info"},se={class:"t1"},ae={class:"t2"},oe={key:2,class:"list"},ne=L({__name:"Search",setup(m){const c=i(""),{page:r,pageSize:u,total:_,data:l,hasMore:f,reset:y,append:k,updateTotal:S,setNoMore:d}=j(),v=i([]);function V(){const e=localStorage.getItem("recentSearches");v.value=e?JSON.parse(e):[]}function w(e){if(!e)return;const t=[e,...v.value.filter(b=>b!==e)].slice(0,5);v.value=t,localStorage.setItem("recentSearches",JSON.stringify(t))}async function h(e=!0){e&&y();const t=await F.post("search/search",{search:c.value,page:r.value,pageSize:u.value});t.code===1&&(k(t.data.list||[]),S(t.data.total||0),l.value.length>=_.value&&d(),w(c.value))}const C=J();function x(e){e.types==="work"&&C.push(`/work/${e.id}`),e.types==="artist"&&C.push(`/artist/${e.id}`),e.types==="institution"&&C.push(`/institution/${e.id}`)}function z(){f.value&&(r.value+=1,h(!1))}T(V);function H(e){return console.log(e),!e||!e.thumb_img&&!e.image?"":e.thumb_img?`${K}/${e.thumb_img}`:e.image}return(e,t)=>{const b=E("a-empty");return n(),o("div",P,[a("div",q,[U(a("input",{class:"field",placeholder:"请输入关键词","onUpdate:modelValue":t[0]||(t[0]=s=>c.value=s),onKeyup:D(h,["enter"])},null,544),[[A,c.value]]),a("button",{class:"btn",onClick:h},"搜索")]),v.value.length?(n(),o("div",G,[t[1]||(t[1]=a("div",{class:"title"},"搜索记录",-1)),a("div",Q,[(n(!0),o($,null,B(v.value,s=>(n(),o("span",{key:s,onClick:M=>{c.value=s,h()}},g(s),9,W))),128))])])):N("",!0),p(l)&&p(l).length?(n(),o("div",X,[a("div",Y,"相关条目有 "+g(p(_))+" 项",1),(n(!0),o($,null,B(p(l),(s,M)=>(n(),o("div",{class:"item",key:M,onClick:le=>x(s)},[a("div",ee,[I(R,{src:H(s)},null,8,["src"])]),a("div",te,[a("div",se,g(s.name),1),a("div",ae,g(s.ename),1)])],8,Z))),128)),p(f)?(n(),o("div",{key:0,class:"loadmore",onClick:z},"加载更多")):N("",!0)])):(n(),o("div",oe,[I(b,{description:"暂无数据"})]))])}}}),re=O(ne,[["__scopeId","data-v-b050a5d0"]]);export{re as default};
